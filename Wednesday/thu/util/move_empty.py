import json, os

JSON_DIR = '../../../dataset/json'
JSON_DIR_ALL = '../../../dataset/all_datas/json'

buxuyao = ['450265', '450266', '450267', '450274', '450439', '450440', '450496', '450497', '450648', '450649', '450650', '450651', '450652', '450653', '450964', '450965', '452413', '452779', '465205', '465255', '469529', '471068', '471226', '475622', '479245', '451371', '463798', '450275', '450276', '456591', '450801', '451066', '451970', '463340', '466885', '467539', '469065', '472008', '475220', '477903', '451370', '459134', '462388', '451067', '464841', '469118', '473196', '476502', '468107', '451503', '451511', '452612', '461114', '469342', '471394', '478687', '475636', '451513', '462156', '450481', '450629', '450633', '450662', '450663', '450664', '450665', '450736', '450737', '450739', '450771', '450773', '450775', '450899', '451028', '451109', '451288', '451342', '451367', '451385', '451398', '451536', '451632', '451658', '451662', '451663', '451691', '451707', '451709', '451711', '451716', '451717', '451725', '451727', '451749', '451750', '451756', '451797', '451798', '451799', '451800', '451801', '451802', '451803', '451804', '451805', '451806', '451807', '451873', '451877', '451905', '451906', '451907', '451909', '451912', '451913', '451914', '451954', '451956', '452046', '452048', '452050', '452171', '452210', '452225', '452317', '452388', '452389', '452402', '452420', '452421', '452423', '452440', '452447', '452448', '452492', '452540', '452572', '452573', '452610', '452633', '452696', '452698', '452702', '452739', '453149', '453380', '453561', '453563', '453738', '453795', '453807', '454078', '454174', '454292', '454294', '455447', '455820', '461360', '465520', '465840', '466550', '466553', '466555', '466559', '466701', '467997', '468430', '469077', '469696', '470679', '471189', '471193', '471855', '472393', '473259', '473618', '474534', '475687', '477134', '451747', '452314', '452553', '452609', '452735', '460220', '466733', '469694', '469834', '471197', '472735', '472736', '451384', '465518', '452539', '469833', '451628', '466549', '452313', '472453', '465999', '451895', '452320', '452355', '452458', '466732', '451757', '451950', '451951', '452055', '452700', '452701', '452707', '452708', '452709', '475589', '451688', '455884', '469794', '477869', '452182', '477136', '465523', '461273', '466661', '452567', '453590', '455455', '458309', '467862', '463376', '466322', '466561', '453115', '466564', '477868', '465524', '477500', '467889', '471957', '469120', '450004', '450001', '450006', '450012', '450021', '450022', '450026', '450027', '450405', '450410', '450412', '450436', '450479', '450618', '450631', '450647', '450670', '450677', '450759', '450762', '450975', '450976', '451020', '451021', '451032', '451202', '451328', '451372', '451474', '451868', '451869', '451874', '451875', '451879', '451881', '451891', '451936', '451946', '451988', '452193', '452319', '452327', '452591', '452600', '460871', '461017', '465490', '466670', '466947', '467077', '467170', '467540', '467867', '474572', '466237', '451016', '450087', '450088', '450089', '450090', '450092', '450093', '450094', '450095', '450098', '450113', '450114', '450115', '450116', '450118', '450119', '450120', '450122', '450123', '450256', '450257', '450260', '450262', '450263', '450264', '450268', '450288', '450289', '450290', '450291', '450292', '450295', '450296', '450297', '450298', '450299', '450300', '450301', '450304', '450305', '450313', '450321', '450322', '450326', '459406', '450112', '450635', '451171', '451326', '466375', '467870', '467871', '469086', '469388', '469959', '470086', '470735', '471902', '472569', '473056', '473114', '473155', '473180', '473186', '473554', '473556', '473610', '473648', '473701', '474111', '474626', '475701', '476750', '476928', '478378', '450110', '451172', '451173', '451174', '451175', '451176', '451179', '451180', '451181', '451022', '452169', '454060', '456097', '451844', '453799', '464988', '465284', '470195', '478384', '450111', '451170', '451177', '451178', '468731', '450349', '450387', '450638', '450658', '450920', '450957', '460907', '461552', '472170', '478994', '450139', '450164', '450177', '450258', '450287', '450401', '450700', '450708', '450713', '450802', '450995', '451160', '451311', '451330', '451602', '451754', '451819', '451828', '451829', '452016', '452541', '452570', '452734', '452738', '452750', '452755', '461272', '461775', '464035', '464840', '465472', '465501', '466392', '466539', '466546', '466569', '466571', '466575', '466577', '466664', '466699', '466708', '466727', '467208', '467478', '467528', '467837', '468120', '468437', '468916', '469017', '469702', '469712', '470929', '470935', '471143', '471179', '471192', '471194', '471698', '472127', '472421', '472574', '472612', '473033', '473035', '473596', '473598', '473687', '474269', '474517', '475434', '475758', '476741', '476752', '476756', '476929', '477420', '477421', '478076', '478506', '478867', '479041', '479356', '479604', '479606', '479755', '450132', '450133', '450134', '450135', '450138', '450140', '450141', '450142', '450143', '450154', '450747', '451015', '451123', '451124', '451125', '451391', '451408', '451577', '451600', '451975', '451976', '451985', '452410', '452513', '455010', '455011', '455429', '457090', '459157', '459357', '460597', '460870', '461106', '461468', '462065', '462153', '465139', '465502', '466272', '466414', '466807', '466899', '467200', '468002', '468924', '469172', '469219', '469349', '469425', '470653', '471095', '474030', '474033', '475348', '476733', '478544', '479905', '479906', '450704', '450717', '451161', '451162', '451304', '451312', '461630', '467875', '450620', '450623', '454109', '469590', '452880', '450167', '458641', '450612', '450613', '450147', '465972', '452588', '452589', '452775', '452777', '453151', '453408', '453409', '453497', '454233', '468144', '468725', '477902', '465663', '451191']
def load_report(id):
  reportfile = open(JSON_DIR_ALL + '/stack_data-' + str(id) + '.json')
  return json.load(reportfile)

def load_id_from_dir(path=JSON_DIR_ALL):
  ids = []
  filenames = os.listdir(path)
  for filename in filenames:  # 遍历文件夹
    report_id = int(filename[11:-5])
    ids.append(report_id)
  return ids

def save_report(id, report):
  with open(JSON_DIR + '/stack_data-' + str(id) + '.json', 'w') as outfile:
    json.dump(report, outfile)

def is_empty(report):
  stack_arrs = report['stack_arr']
  if len(stack_arrs) == 0: return True
  # for i in range(0, len(stack_arrs)):
  #   stack = stack_arrs[i]
  #   calls = stack['calls']
  #   if len(calls) == 0:
  #     return True
  calls = stack_arrs[0]['calls']
  if len(calls) == 0: return True
  return False

def start():
  ids = load_id_from_dir()
  count = 0
  for id in ids:
    report = load_report(id)
    if not is_empty(report):
      print("save report: ", id)
      save_report(id, report)
      count += 1
  print("total count: ", count)

def start2(): # 去除部分数据，（数据太多了。。
  ids = load_id_from_dir()
  count = 0
  for id in ids:
    if str(id) in buxuyao: continue
    if id > 450000 and id < 480000:
      report = load_report(id)
      if not is_empty(report):
        print("save report: ", id)
        save_report(id, report)
        count += 1
  print("total count: ", count)

start2()